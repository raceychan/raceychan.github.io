"use strict";(self.webpackChunkblogs=self.webpackChunkblogs||[]).push([[1978],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var i=t(96540);const o={},s=i.createContext(o);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}},28601:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"advance/plugin/jwt","title":"jwt","description":"Lihil comes with authentification & authorization plugins out of the box.","source":"@site/docs/advance/plugin/jwt.md","sourceDirName":"advance/plugin","slug":"/advance/plugin/jwt","permalink":"/docs/advance/plugin/jwt","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"jwt"},"sidebar":"tutorialSidebar","previous":{"title":"Plugin System","permalink":"/docs/advance/plugin/"},"next":{"title":"event","permalink":"/docs/advance/plugin/message bus"}}');var o=t(74848),s=t(28453);const r={title:"jwt"},l=void 0,a={},c=[{value:"Lihil comes with authentification &amp; authorization plugins out of the box.",id:"lihil-comes-with-authentification--authorization-plugins-out-of-the-box",level:2},{value:"Authorization with function dependency",id:"authorization-with-function-dependency",level:3},{value:"Encode/Decode a string value as JWT",id:"encodedecode-a-string-value-as-jwt",level:3},{value:"JWTConfig",id:"jwtconfig",level:2}];function u(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"lihil-comes-with-authentification--authorization-plugins-out-of-the-box",children:"Lihil comes with authentification & authorization plugins out of the box."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'from lihil import Payload, Route\nfrom lihil.plugins.auth.jwt import JWTAuthParam, JWTAuthPlugin, JWTConfig\nfrom lihil.plugins.auth.oauth import OAuth2PasswordFlow, OAuthLoginForm\n\nme = Route("/me")\ntoken = Route("/token")\n\njwt_auth_plugin = JWTAuthPlugin(jwt_secret="mysecret", jwt_algorithms="HS256")\n\nclass UserProfile(Struct):\n    user_id: str = field(name="sub")\n    role: Literal["admin", "user"] = "user"\n\n@me.get(auth_scheme=OAuth2PasswordFlow(token_url="token"), plugins=[jwt_auth_plugin.decode_plugin()])\nasync def get_user(profile: Annotated[UserProfile, JWTAuthParam]) -> User:\n    assert profile.role == "user"\n    return User(name="user", email="user@email.com")\n\n@token.post(plugins=[jwt_auth_plugin.encode_plugin(expires_in_s=3600)])\nasync def login_get_token(credentials: OAuthLoginForm) -> UserProfile:\n    return UserProfile(user_id="user123")\n'})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["When you return ",(0,o.jsx)(n.code,{children:"UserProfile"})," from ",(0,o.jsx)(n.code,{children:"login_get_token"})," endpoint, it would automatically be serialized as a json web token."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"authorization-with-function-dependency",children:"Authorization with function dependency"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'def is_admin(profile: Annotated[UserProfile, JWTAuthParam]) -> bool:\n    return profile.role == "admin"\n\n@me.get(auth_scheme=OAuth2PasswordFlow(token_url="token"), plugins=[jwt_auth_plugin.decode_plugin()])\nasync def get_admin_user(profile: Annotated[UserProfile, JWTAuthParam], _: Annotated[bool, use(is_admin)]) -> User:\n    return User(name="user", email="user@email.com")\n'})}),"\n",(0,o.jsx)(n.h3,{id:"encodedecode-a-string-value-as-jwt",children:"Encode/Decode a string value as JWT"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'@token.post(plugins=[jwt_auth_plugin.encode_plugin(expires_in_s=3600)])\nasync def login_get_token(credentials: OAuthLoginForm) -> str:\n    return "user123"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"jwtconfig",children:"JWTConfig"}),"\n",(0,o.jsxs)(n.p,{children:["To use ",(0,o.jsx)(n.code,{children:"JWTAuthPlugin"}),", you would need to provide jwt secret key and algorithm."]}),"\n",(0,o.jsxs)(n.p,{children:["you can do this by creating a ",(0,o.jsx)(n.code,{children:"JWTConfig"})," instance and passing it to ",(0,o.jsx)(n.code,{children:"Lihil"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'from lihil.config import lhl_read_config\nfrom lihil.plugins.auth.jwt import JWTConfig\n\n\nconfig = lhl_read_config(".env", config_type=JWTConfig)\nlhl = Lihil(app_config=config)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["where the ",(0,o.jsx)(n.code,{children:".env"})," file should contain:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-env",children:"JWT_SECRET=your_secret_key\nJWT_ALGORITHM=HS256\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Alternatively, you can use your own config class and implementing ",(0,o.jsx)(n.code,{children:"IJWTConfig"})," interface:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'class MyConfig(BaseModel):\n    JWT_SECRET: str\n    JWT_ALGORITHM: str = "HS256"\n'})}),"\n",(0,o.jsx)(n.p,{children:"then set it as the app config"})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}}}]);
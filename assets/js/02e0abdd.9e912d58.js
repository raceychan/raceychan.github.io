"use strict";(self.webpackChunkblogs=self.webpackChunkblogs||[]).push([[2755],{4921:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"basics/websocket","title":"websocket","description":"WebSocket","source":"@site/docs/basics/websocket.md","sourceDirName":"basics","slug":"/basics/websocket","permalink":"/docs/basics/websocket","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"websocket"},"sidebar":"tutorialSidebar","previous":{"title":"application","permalink":"/docs/basics/app"},"next":{"title":"error-handling","permalink":"/docs/basics/error-handling"}}');var o=t(4848),i=t(8453);const c={sidebar_position:3,title:"websocket"},r=void 0,a={},l=[{value:"WebSocket",id:"websocket",level:3},{value:"websocket vs http",id:"websocket-vs-http",level:4}];function d(e){const s={code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.h3,{id:"websocket",children:"WebSocket"}),"\n",(0,o.jsxs)(s.p,{children:["lihil supports the usage of websocket, you might use ",(0,o.jsx)(s.code,{children:"WebSocketRoute.ws_handler"})," to register a function that handles websockets."]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-python",children:'from lihil import WebSocketRoute, WebSocket, Ignore, use\n\nws_route = WebSocketRoute("web_socket/{session_id}")\n\nasync def ws_factory(ws: Ignore[WebSocket]) -> Ignore[AsyncResource[WebSocket]]:\n    await ws.accept()\n    yield ws\n    await ws.close()\n\n@ws_route.ws_handler\nasync def ws_handler(\n    ws: Annotated[WebSocket, use(ws_factory, reuse=False)],\n    session_id: str,\n    max_users: int,\n):\n    assert session_id == "session123" and max_users == 5\n    await ws.send_text("Hello, world!")\n\nlhl = Lihil[None]()\nlhl.include_routes(ws_route)\n'})}),"\n",(0,o.jsx)(s.p,{children:"Testing"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-python",children:'from lihil.vendors import TestClient # require httpx installed\n\nclient = TestClient(lhl)\nwith client:\n    with client.websocket_connect(\n        "/web_socket/session123?max_users=5"\n    ) as websocket:\n        data = websocket.receive_text()\n        assert data == "Hello, world!"\n'})}),"\n",(0,o.jsx)(s.h4,{id:"websocket-vs-http",children:"websocket vs http"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"WebSocket handlers must be asynchronous \u2014 since communication is bidirectional and event-driven, the handler must use async def to support non-blocking interaction."}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"WebSocket connections do not support request bodies in the same way as HTTP \u2014 there is no Body parameter during the handshake. All data is exchanged after the connection is established, typically through messages sent via the WebSocket protocol."}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"WebSockets are stateful \u2014 unlike HTTP, which is stateless, a WebSocket connection persists, allowing continuous communication between the client and server. This enables maintaining per-connection state (e.g. user sessions, in-memory data)."}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"WebSockets use a different lifecycle \u2014 they begin with an HTTP handshake (usually a GET request), then upgrade the protocol. After that, communication is done over the WebSocket protocol, not HTTP."}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"Standard request/response patterns do not apply \u2014 WebSockets are message-based and support real-time interaction, so traditional concepts like status codes, headers per message, or body parsing don\u2019t directly apply after the initial handshake."}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>c,x:()=>r});var n=t(6540);const o={},i=n.createContext(o);function c(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);
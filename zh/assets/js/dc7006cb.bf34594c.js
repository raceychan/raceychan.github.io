"use strict";(self.webpackChunkblogs=self.webpackChunkblogs||[]).push([[5828],{25016:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"minicourse","title":"Mini Course","description":"we will go through some of the common concept related to web development that would help you better understand our tutorials.","source":"@site/docs/minicourse.md","sourceDirName":".","slug":"/minicourse","permalink":"/zh/docs/minicourse","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"FastAPI","permalink":"/zh/docs/comparison/fastapi"}}');var o=i(74848),r=i(28453);const c={},d="Mini Course",l={},t=[{value:"<code>Resource</code>",id:"resource",level:2},{value:"Any identifiable <code>entity</code> that can be accessed via a URL",id:"any-identifiable-entity-that-can-be-accessed-via-a-url",level:3},{value:"<code>Entity</code>",id:"entity",level:2},{value:"<code>URI</code>",id:"uri",level:2},{value:"Uniform Resource Identifier",id:"uniform-resource-identifier",level:3},{value:"<code>ASGI</code>",id:"asgi",level:2},{value:"<code>ASGIApp</code>",id:"asgiapp",level:2},{value:"<code>ASGI Call Chain</code>",id:"asgi-call-chain",level:3},{value:"Inversion of Control &amp; Dependency Injection",id:"inversion-of-control--dependency-injection",level:2},{value:"Inversion of Control",id:"inversion-of-control",level:3},{value:"Compare to menually building dependency inside endpoint function",id:"compare-to-menually-building-dependency-inside-endpoint-function",level:3}];function a(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"mini-course",children:"Mini Course"})}),"\n",(0,o.jsx)(n.p,{children:"we will go through some of the common concept related to web development that would help you better understand our tutorials."}),"\n",(0,o.jsx)(n.h2,{id:"resource",children:(0,o.jsx)(n.code,{children:"Resource"})}),"\n",(0,o.jsxs)(n.h3,{id:"any-identifiable-entity-that-can-be-accessed-via-a-url",children:["Any identifiable ",(0,o.jsx)(n.code,{children:"entity"})," that can be accessed via a URL"]}),"\n",(0,o.jsxs)(n.p,{children:["Don't overthink it\u2014if you don\u2019t like the term ",(0,o.jsx)(n.code,{children:"resource"}),", think of it as an ",(0,o.jsx)(n.code,{children:"object"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"entity",children:(0,o.jsx)(n.code,{children:"Entity"})}),"\n",(0,o.jsx)(n.p,{children:"Anyting that can be uniquely identified. for example"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from dataclasses import dataclass, field\nfrom uuid import uuid4\n\nclass User:\n    user_id: str = field(default_factory=lambda: str(uuid4()))\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Here, ",(0,o.jsx)(n.code,{children:"User"})," is an entity as can be uniquely identified through ",(0,o.jsx)(n.code,{children:"user_id"}),".\nmeaing that, for any given two instances of ",(0,o.jsx)(n.code,{children:"User"}),", ",(0,o.jsx)(n.code,{children:"u1"})," and ",(0,o.jsx)(n.code,{children:"u2"}),", if ",(0,o.jsx)(n.code,{children:"u1.user_id"})," == ",(0,o.jsx)(n.code,{children:"u2.user_id"})," then ",(0,o.jsx)(n.code,{children:"u1 == u2"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"uri",children:(0,o.jsx)(n.code,{children:"URI"})}),"\n",(0,o.jsx)(n.h3,{id:"uniform-resource-identifier",children:"Uniform Resource Identifier"}),"\n",(0,o.jsx)(n.p,{children:"A string that uniquely identifies a resource. a uri can be a url, a urn, or both. a url follows the format:"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"protocol://domain/path?query#fragment"})}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"#fragment"})," is commonly used for client-side navigation, usually you do not need it writing server side application."]}),"\n",(0,o.jsx)(n.p,{children:"Example:"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"https://myhost.com/users/lhl/orders?nums=3"})}),"\n",(0,o.jsx)(n.p,{children:"When you see a RESTful API with a URI like this, even without prior knowledge, you can infer that:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["It is a website hosted at ",(0,o.jsx)(n.code,{children:"myhost.com"}),", using the ",(0,o.jsx)(n.code,{children:"https"})," protocol."]}),"\n",(0,o.jsxs)(n.li,{children:["It is accessing a resource named ",(0,o.jsx)(n.code,{children:"orders"}),", which belongs to a specific user ",(0,o.jsx)(n.code,{children:"lhl"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["It includes a query parameter, ",(0,o.jsx)(n.code,{children:"nums"}),", with the value ",(0,o.jsx)(n.code,{children:"3"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"URL"})," (Uniform Resource Locator): A type of URI that not only identifies a resource but also provides a way to access it. URLs generally include a scheme (protocol), domain, path, query parameters, and optionally a fragment."]}),"\n",(0,o.jsx)(n.h2,{id:"asgi",children:(0,o.jsx)(n.code,{children:"ASGI"})}),"\n",(0,o.jsxs)(n.p,{children:["ASGI refering to ",(0,o.jsx)(n.code,{children:"Asynchronous Server Gateway Interface"}),", a protocol designed by ",(0,o.jsx)(n.code,{children:"encode"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"asgiapp",children:(0,o.jsx)(n.code,{children:"ASGIApp"})}),"\n",(0,o.jsx)(n.p,{children:"is an async callable with following signature."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"class ASGIApp(Protocol):\n    async def __call__(self, scope, receive, send) -> None: ...\n"})}),"\n",(0,o.jsx)(n.p,{children:"where"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"scope"})," is a mutable mapping, often a ",(0,o.jsx)(n.code,{children:"dict"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"receive"})," is an async callable that has no param and return a ",(0,o.jsx)(n.code,{children:"message"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"message"})," is also a mutable mapping, often ",(0,o.jsx)(n.code,{children:"dict"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"send"}),"  is an async callable that receive a single param ",(0,o.jsx)(n.code,{children:"message"})," and return ",(0,o.jsx)(n.code,{children:"None"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Many components you see from ",(0,o.jsx)(n.code,{children:"lihil"})," implementes ",(0,o.jsx)(n.code,{children:"ASGIApp"}),", including"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Lihil"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Route"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Endpoint"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Response"})}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["asgi middlewares are also ",(0,o.jsx)(n.code,{children:"ASGIApp"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"asgi-call-chain",children:(0,o.jsx)(n.code,{children:"ASGI Call Chain"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"ASGIApp"})," are often chained together like a linked list(you might recognize this as the ",(0,o.jsx)(n.code,{children:"chain of responsibility"})," pattern), where each call to the chain go through every node on the chain, for example, a ordinary call stack looks like this"]}),"\n",(0,o.jsx)(n.mermaid,{value:"flowchart LR\n    A[lihil.Lihil]\n    A --\x3e B[lihil.Route]\n    B --\x3e C[lihil.Endpoint]\n    C --\x3e D[Endpoint Function]"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"Endpoint Function"}),"  is the function you registered with ",(0,o.jsx)(n.code,{children:"Route.{http method}"}),", such as ",(0,o.jsx)(n.code,{children:"Route.get"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["If you server lihil with an ASGI server such as uvicorn, ",(0,o.jsx)(n.code,{children:"lihil.Lihil"})," will be called by uvicorn."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"inversion-of-control--dependency-injection",children:"Inversion of Control & Dependency Injection"}),"\n",(0,o.jsx)(n.h3,{id:"inversion-of-control",children:"Inversion of Control"}),"\n",(0,o.jsxs)(n.p,{children:["Although the term ",(0,o.jsx)(n.code,{children:"Inversion of Control"})," might sound exotic and fancy, and can be interpreted at different levels of software design, we only talk about one of its narrow sense here,"]}),"\n",(0,o.jsx)(n.p,{children:"Imagine you are writing a module that creates a user in database, you might have something like:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'from sqlalchemy.ext.asyncio import create_engine, AsyncEngine\n\nclass Repo:\n    def __init__(self, engine: AsyncEngine):\n        self.engine = engine\n\n    async def add_user(self, user: User):\n        prepared_stmt = sle.prepare_add_user(user)\n        async with self.engine.connct() as conn:\n            await conn.execute(prepared_stmt)\n\nasync def create_user(user: User, repo: Repository):\n    await repo.add_user(user)\n\nasync def main():\n    engine = create_engine(url=url)\n    repo = Repo(engine)\n    user = User(name="user")\n    await create_user(user, repo)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Here you are calling ",(0,o.jsx)(n.code,{children:"create_user"})," from your ",(0,o.jsx)(n.code,{children:"main"})," function inside a ",(0,o.jsx)(n.code,{children:"main.py"}),", when you enter ",(0,o.jsx)(n.code,{children:"python -m myproject.main"}),", function ",(0,o.jsx)(n.code,{children:"main"})," and ",(0,o.jsx)(n.code,{children:"create_user"})," gets called."]}),"\n",(0,o.jsx)(n.p,{children:"Comparing with what would you do with lihil:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'users_route = Route("/users")\n\n@users_route.post\nasync def create_user(user: User, repo: Repository):\n    await repo.add_user(user)\n\nlhl = Lihil(user_route)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Notice here, instead of you actively calling ",(0,o.jsx)(n.code,{children:"create_user"})," from your function, your function is called by lihil upon request arrival, and the dependencies of your ",(0,o.jsx)(n.code,{children:"create_user"})," is managed and injected by lihil."]}),"\n",(0,o.jsxs)(n.p,{children:["This is an example of ",(0,o.jsx)(n.code,{children:"Inversion of Control"})," and also one of the major reasons why a dedicated dependency injection tool ",(0,o.jsx)(n.code,{children:"ididi"})," is used by lihil."]}),"\n",(0,o.jsx)(n.h3,{id:"compare-to-menually-building-dependency-inside-endpoint-function",children:"Compare to menually building dependency inside endpoint function"}),"\n",(0,o.jsx)(n.p,{children:"You might wonder why not building dependencies yourself inside the endpoint function."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"@users_route.post\nasync def create_user(user: User):\n    engine = create_engine(url=url)\n    repo = Repo(engine)\n    await repo.add_user(user)\n"})}),"\n",(0,o.jsxs)(n.p,{children:["As we are not dynamically injecting ",(0,o.jsx)(n.code,{children:"Repo"})," into ",(0,o.jsx)(n.code,{children:"create_user"}),", we lose the benifits of"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"separation of interface and implementation:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"often we want to build engine differently depending on the environment we are deploying our app on, for example, you might want to increase the size of connection pool in prod."}),"\n",(0,o.jsxs)(n.li,{children:["we won't be executing real query during test so we would need to mock the ",(0,o.jsx)(n.code,{children:"Engine"})," object."]}),"\n",(0,o.jsxs)(n.li,{children:["if we create a new ",(0,o.jsx)(n.code,{children:"AdvacnedEngine(Engine)"})," to cater our business need, we can't let ",(0,o.jsx)(n.code,{children:"create_user"})," use it without modifying the code inside."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["lifetime control:\nDependencies have differernt lifetime, for example,\nyou might want to reuse a same ",(0,o.jsx)(n.code,{children:"AsyncEngine"})," across different requests, but open a new ",(0,o.jsx)(n.code,{children:"AsyncConnection"})," to handle each request."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>d});var s=i(96540);const o={},r=s.createContext(o);function c(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);
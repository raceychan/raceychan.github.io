"use strict";(self.webpackChunkblogs=self.webpackChunkblogs||[]).push([[1675],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>s});var t=i(96540);const r={},l=t.createContext(r);function o(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(l.Provider,{value:n},e.children)}},51875:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"advance/plugin/jwt","title":"JWT","description":"Lihil \u5f00\u7bb1\u5373\u7528\u5730\u63d0\u4f9b\u8ba4\u8bc1\u548c\u6388\u6743\u63d2\u4ef6\u3002","source":"@site/i18n/zh/docusaurus-plugin-content-docs/current/advance/plugin/jwt.md","sourceDirName":"advance/plugin","slug":"/advance/plugin/jwt","permalink":"/zh/docs/advance/plugin/jwt","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"JWT"},"sidebar":"tutorialSidebar","previous":{"title":"\u63d2\u4ef6\u7cfb\u7edf","permalink":"/zh/docs/advance/plugin/"},"next":{"title":"\u4e8b\u4ef6","permalink":"/zh/docs/advance/plugin/message bus"}}');var r=i(74848),l=i(28453);const o={title:"JWT"},s=void 0,c={},a=[{value:"Lihil \u5f00\u7bb1\u5373\u7528\u5730\u63d0\u4f9b\u8ba4\u8bc1\u548c\u6388\u6743\u63d2\u4ef6\u3002",id:"lihil-\u5f00\u7bb1\u5373\u7528\u5730\u63d0\u4f9b\u8ba4\u8bc1\u548c\u6388\u6743\u63d2\u4ef6",level:2},{value:"\u4f7f\u7528\u51fd\u6570\u4f9d\u8d56\u8fdb\u884c\u6388\u6743",id:"\u4f7f\u7528\u51fd\u6570\u4f9d\u8d56\u8fdb\u884c\u6388\u6743",level:3},{value:"\u5c06\u5b57\u7b26\u4e32\u503c\u7f16\u7801/\u89e3\u7801\u4e3a JWT",id:"\u5c06\u5b57\u7b26\u4e32\u503c\u7f16\u7801\u89e3\u7801\u4e3a-jwt",level:3},{value:"JWTConfig",id:"jwtconfig",level:2}];function u(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"lihil-\u5f00\u7bb1\u5373\u7528\u5730\u63d0\u4f9b\u8ba4\u8bc1\u548c\u6388\u6743\u63d2\u4ef6",children:"Lihil \u5f00\u7bb1\u5373\u7528\u5730\u63d0\u4f9b\u8ba4\u8bc1\u548c\u6388\u6743\u63d2\u4ef6\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from lihil import Payload, Route\nfrom lihil.plugins.auth.jwt import JWTAuthParam, JWTAuthPlugin, JWTConfig\nfrom lihil.plugins.auth.oauth import OAuth2PasswordFlow, OAuthLoginForm\n\nme = Route("/me")\ntoken = Route("/token")\n\njwt_auth_plugin = JWTAuthPlugin(jwt_secret="mysecret", jwt_algorithms="HS256")\n\nclass UserProfile(Struct):\n    user_id: str = field(name="sub")\n    role: Literal["admin", "user"] = "user"\n\n@me.get(auth_scheme=OAuth2PasswordFlow(token_url="token"), plugins=[jwt_auth_plugin.decode_plugin()])\nasync def get_user(profile: Annotated[UserProfile, JWTAuthParam]) -> User:\n    assert profile.role == "user"\n    return User(name="user", email="user@email.com")\n\n@token.post(plugins=[jwt_auth_plugin.encode_plugin(expires_in_s=3600)])\nasync def login_get_token(credentials: OAuthLoginForm) -> UserProfile:\n    return UserProfile(user_id="user123")\n'})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["\u5f53\u4f60\u4ece ",(0,r.jsx)(n.code,{children:"login_get_token"})," \u7aef\u70b9\u8fd4\u56de ",(0,r.jsx)(n.code,{children:"UserProfile"})," \u65f6\uff0c\u5b83\u4f1a\u81ea\u52a8\u5e8f\u5217\u5316\u4e3a JSON Web Token\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528\u51fd\u6570\u4f9d\u8d56\u8fdb\u884c\u6388\u6743",children:"\u4f7f\u7528\u51fd\u6570\u4f9d\u8d56\u8fdb\u884c\u6388\u6743"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'def is_admin(profile: Annotated[UserProfile, JWTAuthParam]) -> bool:\n    return profile.role == "admin"\n\n@me.get(auth_scheme=OAuth2PasswordFlow(token_url="token"), plugins=[jwt_auth_plugin.decode_plugin()])\nasync def get_admin_user(profile: Annotated[UserProfile, JWTAuthParam], _: Annotated[bool, use(is_admin)]) -> User:\n    return User(name="user", email="user@email.com")\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u5c06\u5b57\u7b26\u4e32\u503c\u7f16\u7801\u89e3\u7801\u4e3a-jwt",children:"\u5c06\u5b57\u7b26\u4e32\u503c\u7f16\u7801/\u89e3\u7801\u4e3a JWT"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'@token.post(plugins=[jwt_auth_plugin.encode_plugin(expires_in_s=3600)])\nasync def login_get_token(credentials: OAuthLoginForm) -> str:\n    return "user123"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"jwtconfig",children:"JWTConfig"}),"\n",(0,r.jsxs)(n.p,{children:["\u8981\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"JWTAuthPlugin"}),"\uff0c\u4f60\u9700\u8981\u63d0\u4f9b JWT \u5bc6\u94a5\u548c\u7b97\u6cd5\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4f60\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa ",(0,r.jsx)(n.code,{children:"JWTConfig"})," \u5b9e\u4f8b\u5e76\u5c06\u5176\u4f20\u9012\u7ed9 ",(0,r.jsx)(n.code,{children:"Lihil"})," \u6765\u505a\u5230\u8fd9\u4e00\u70b9\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from lihil.config import lhl_read_config\nfrom lihil.plugins.auth.jwt import JWTConfig\n\n\nconfig = lhl_read_config(".env", config_type=JWTConfig)\nlhl = Lihil(app_config=config)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u5176\u4e2d ",(0,r.jsx)(n.code,{children:".env"})," \u6587\u4ef6\u5e94\u5305\u542b\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"JWT_SECRET=your_secret_key\nJWT_ALGORITHM=HS256\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6216\u8005\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u81ea\u5df1\u7684\u914d\u7f6e\u7c7b\u5e76\u5b9e\u73b0 ",(0,r.jsx)(n.code,{children:"IJWTConfig"})," \u63a5\u53e3\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'class MyConfig(BaseModel):\n    JWT_SECRET: str\n    JWT_ALGORITHM: str = "HS256"\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u7136\u540e\u5c06\u5176\u8bbe\u7f6e\u4e3a\u5e94\u7528\u914d\u7f6e"})]})}function d(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}}}]);
"use strict";(self.webpackChunkblogs=self.webpackChunkblogs||[]).push([[1799],{1384:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"http/middleware","title":"middleware","description":"\u4e2d\u95f4\u4ef6","source":"@site/i18n/zh/docusaurus-plugin-content-docs/current/http/middleware.md","sourceDirName":"http","slug":"/http/middleware","permalink":"/zh/docs/http/middleware","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u751f\u547d\u5468\u671f","permalink":"/zh/docs/http/lifespan"},"next":{"title":"\u63d2\u4ef6\u7cfb\u7edf","permalink":"/zh/docs/advance/plugin/"}}');var d=t(74848),c=t(28453);const s={},i=void 0,a={},l=[{value:"\u4e2d\u95f4\u4ef6",id:"\u4e2d\u95f4\u4ef6",level:3}];function o(e){const n={code:"code",h3:"h3",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.h3,{id:"\u4e2d\u95f4\u4ef6",children:"\u4e2d\u95f4\u4ef6"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Lihil"})," \u548c ",(0,d.jsx)(n.code,{children:"Route"})," \u90fd\u6709 ",(0,d.jsx)(n.code,{children:"add_middleware"})," API\uff0c\u63a5\u53d7\u4e00\u4e2a\u6216\u4e00\u7cfb\u5217 ",(0,d.jsx)(n.code,{children:"MiddlewareFactory"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"MiddlewareFactory"})," \u662f\u4e00\u4e2a\u53ef\u8c03\u7528\u5bf9\u8c61\uff0c\u63a5\u6536\u4e00\u4e2a\u7c7b\u578b\u4e3a ",(0,d.jsx)(n.code,{children:"ASGIApp"})," \u7684\u4f4d\u7f6e\u53c2\u6570\u5e76\u8fd4\u56de\u4e00\u4e2a ",(0,d.jsx)(n.code,{children:"ASGIApp"}),"\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:'# \u8fd9\u6bb5\u4ee3\u7801\u4ec5\u7528\u4e8e\u6f14\u793a\u3002\n\ndef tracingmw_factory(next_app: ASGIApp) -> ASGIApp:\n    async def tracemw(scope, receive, send):\n        scope["trace_id"] = str(uuid.uuid4())\n        await next_app(scope, receive, send)\n    return trace_mw\n\nlhl = Lihil(middlewares=[lambda app: tracingmw_factory(app)])\n'})}),"\n",(0,d.jsx)(n.p,{children:"lihil \u5185\u90e8\u4f7f\u7528 starlette\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u4ece starlette \u5bfc\u5165\u4e2d\u95f4\u4ef6\uff0c\u4f8b\u5982\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:'from starlette.middleware.cors import CORSMiddleware\n\nlhl = Lihil(middlewares=[lambda app: CORSMiddleware(app, add_methods="*")])\n'})}),"\n",(0,d.jsxs)(n.p,{children:["\u5bf9\u4e8e\u9700\u8981\u8bb8\u591a\u5916\u90e8\u4f9d\u8d56\u9879\u7684\u590d\u6742\u4e2d\u95f4\u4ef6\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u5728\u751f\u547d\u5468\u671f\u5185\u6784\u9020\u5b83\u4eec\uff0c\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"lhl.graph"})," \u6765\u89e3\u6790\u4f9d\u8d56\u9879\u3002"]})]})}function p(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(o,{...e})}):o(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>i});var r=t(96540);const d={},c=r.createContext(d);function s(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunkblogs=self.webpackChunkblogs||[]).push([[4659],{28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>r});var o=t(96540);const i={},s=o.createContext(i);function l(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),o.createElement(s.Provider,{value:n},e.children)}},82438:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"testing","title":"\u0422\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435","description":"Lihil \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0432\u0430\u043c \u0434\u0432\u0430 \u043c\u0435\u0442\u043e\u0434\u0430 \u0434\u043b\u044f \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f: TestClient \u0438 LocalClient","source":"@site/i18n/ru/docusaurus-plugin-content-docs/current/testing.md","sourceDirName":".","slug":"/testing","permalink":"/ru/docs/testing","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"\u0422\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"throttling","permalink":"/ru/docs/advance/plugin/throttling"},"next":{"title":"\u0420\u0430\u0437\u0432\u0435\u0440\u0442\u044b\u0432\u0430\u043d\u0438\u0435","permalink":"/ru/docs/deployment"}}');var i=t(74848),s=t(28453);const l={title:"\u0422\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435",sidebar_position:3},r="\u0422\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435",c={},a=[{value:"<code>TestClient</code>",id:"testclient",level:2},{value:"<code>LocalClient</code>",id:"localclient",level:2},{value:"\u0422\u0435\u0441\u0442\u0438\u0440\u0443\u0439\u0442\u0435 \u043b\u044e\u0431\u0443\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u044e \u043a\u0430\u043a \u0435\u0441\u043b\u0438 \u0431\u044b \u043e\u043d\u0430 \u0431\u044b\u043b\u0430 endpoint:",id:"\u0442\u0435\u0441\u0442\u0438\u0440\u0443\u0439\u0442\u0435-\u043b\u044e\u0431\u0443\u044e-\u0444\u0443\u043d\u043a\u0446\u0438\u044e-\u043a\u0430\u043a-\u0435\u0441\u043b\u0438-\u0431\u044b-\u043e\u043d\u0430-\u0431\u044b\u043b\u0430-endpoint",level:3},{value:"\u0422\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043b\u043e\u0436\u043d\u043e\u0433\u043e \u043f\u043e\u0442\u043e\u043a\u0430 \u0441 LocalClient",id:"\u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435-\u0441\u043b\u043e\u0436\u043d\u043e\u0433\u043e-\u043f\u043e\u0442\u043e\u043a\u0430-\u0441-localclient",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435",children:"\u0422\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435"})}),"\n",(0,i.jsxs)(n.p,{children:["Lihil \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0432\u0430\u043c \u0434\u0432\u0430 \u043c\u0435\u0442\u043e\u0434\u0430 \u0434\u043b\u044f \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f: ",(0,i.jsx)(n.code,{children:"TestClient"})," \u0438 ",(0,i.jsx)(n.code,{children:"LocalClient"})]}),"\n",(0,i.jsx)(n.h2,{id:"testclient",children:(0,i.jsx)(n.code,{children:"TestClient"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"TestClient"})," \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0432\u0430\u043c \u0447\u0442\u043e-\u0442\u043e \u0431\u043b\u0438\u0437\u043a\u043e\u0435 \u043a \u0440\u0443\u0447\u043d\u043e\u043c\u0443 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044e \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043a\u0430\u043a \u043a\u043b\u0438\u0435\u043d\u0442 \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u0435\u0433\u043e \u043d\u0430 \u0432\u0430\u0448 \u0441\u0435\u0440\u0432\u0435\u0440."]}),"\n",(0,i.jsxs)(n.p,{children:["\u0414\u043b\u044f \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u043e\u0433\u043e \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u0433\u0434\u0435 \u043a\u0430\u0436\u0434\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442\u044c \u0447\u0435\u0440\u0435\u0437 \u043a\u0430\u0436\u0434\u0443\u044e \u0447\u0430\u0441\u0442\u044c \u0432\u0430\u0448\u0435\u0433\u043e \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f, ",(0,i.jsx)(n.code,{children:"TestClient"})," \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0432\u0430\u0448 \u0442\u0435\u0441\u0442 \u0431\u043b\u0438\u0437\u043a\u0438\u043c \u043a \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f."]}),"\n",(0,i.jsxs)(n.p,{children:["\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f ",(0,i.jsx)(n.code,{children:"TestClient"})," \u0432\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c ",(0,i.jsx)(n.code,{children:"httpx"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"localclient",children:(0,i.jsx)(n.code,{children:"LocalClient"})}),"\n",(0,i.jsxs)(n.p,{children:["\u0435\u0441\u043b\u0438 \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435 \u0447\u0442\u043e-\u0442\u043e \u043c\u0435\u043d\u0435\u0435 \u043c\u043d\u043e\u0433\u043e\u0441\u043b\u043e\u0432\u043d\u043e\u0435 \u0438 \u0441 \u043c\u0435\u043d\u044c\u0448\u0435\u0439 \u0434\u0435\u0442\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0435\u0439, \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0437\u0443\u0447\u0438\u0442\u044c ",(0,i.jsx)(n.code,{children:"LocalClient"}),","]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"LocalClient"})," \u0431\u043e\u043b\u044c\u0448\u0435 \u043f\u043e\u043c\u043e\u0449\u043d\u0438\u043a \u0434\u043b\u044f \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u0447\u0435\u043c \u043f\u043e\u043b\u043d\u043e\u0446\u0435\u043d\u043d\u044b\u0439 \u043a\u043b\u0438\u0435\u043d\u0442 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432 \u043e\u0442\u043b\u0438\u0447\u0438\u0435 \u043e\u0442 ",(0,i.jsx)(n.code,{children:"TestClient"}),", \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0435\u0433\u043e \u0434\u043b\u044f \u0432\u044b\u0437\u043e\u0432\u0430 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u0430 ",(0,i.jsx)(n.code,{children:"Lihil"}),", ",(0,i.jsx)(n.code,{children:"Route"})," \u0438 ",(0,i.jsx)(n.code,{children:"Endpoint"})," \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e \u0431\u044b\u0441\u0442\u0440\u044b\u043c \u0438 \u044d\u0440\u0433\u043e\u043d\u043e\u043c\u0438\u0447\u043d\u044b\u043c \u0441\u043f\u043e\u0441\u043e\u0431\u043e\u043c."]}),"\n",(0,i.jsx)(n.h3,{id:"\u0442\u0435\u0441\u0442\u0438\u0440\u0443\u0439\u0442\u0435-\u043b\u044e\u0431\u0443\u044e-\u0444\u0443\u043d\u043a\u0446\u0438\u044e-\u043a\u0430\u043a-\u0435\u0441\u043b\u0438-\u0431\u044b-\u043e\u043d\u0430-\u0431\u044b\u043b\u0430-endpoint",children:"\u0422\u0435\u0441\u0442\u0438\u0440\u0443\u0439\u0442\u0435 \u043b\u044e\u0431\u0443\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u044e \u043a\u0430\u043a \u0435\u0441\u043b\u0438 \u0431\u044b \u043e\u043d\u0430 \u0431\u044b\u043b\u0430 endpoint:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from lihil import LocalClient\n\nasync def test_query_with_default():\n    async def func(name: tuple[str, ...]) -> Empty:\n        assert name == ("aloha",)\n\n    lc = LocalClient()\n\n    resp = await lc.call_endpoint(lc.make_endpoint(func))\n    await resp.body()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435-\u0441\u043b\u043e\u0436\u043d\u043e\u0433\u043e-\u043f\u043e\u0442\u043e\u043a\u0430-\u0441-localclient",children:"\u0422\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043b\u043e\u0436\u043d\u043e\u0433\u043e \u043f\u043e\u0442\u043e\u043a\u0430 \u0441 LocalClient"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'async def test_endpoint_login_and_validate(testroute: Route, lc: LocalClient):\n    from lihil.config import lhl_set_config\n\n    async def get_me(token: JWTAuth[UserProfile]) -> Annotated[Text, status.OK]:\n        assert token.user_id == "1" and token.user_name == "2"\n        return "ok"\n\n    async def login_get_token(login_form: OAuthLoginForm) -> JWTAuth[UserProfile]:\n        return UserProfile(user_id="1", user_name="2")\n\n    testroute.get(auth_scheme=OAuth2PasswordFlow(token_url="token"))(get_me)\n    testroute.post(login_get_token)\n    lhl_set_config(\n        app_config=AppConfig(\n            security=SecurityConfig(jwt_secret="mysecret", jwt_algorithms=["HS256"])\n        )\n    )\n    testroute.setup()\n\n    login_ep = testroute.get_endpoint(login_get_token)\n\n    res = await lc.submit_form(\n        login_ep, form_data={"username": "user", "password": "test"}\n    )\n\n    token_data = await res.json()\n\n    token_type, token = token_data["token_type"], token_data["access_token"]\n    token_type: str\n\n    lc.update_headers({"Authorization": f"{token_type.capitalize()} {token}"})\n\n    meep = testroute.get_endpoint(get_me)\n\n    res = await lc(meep)\n\n    assert res.status_code == 200\n    assert await res.text() == "ok"\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);